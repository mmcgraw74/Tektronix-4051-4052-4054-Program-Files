100 REM Minesweeper for Tiny Basic, by Marcus110 REM Modified for Tektronix 4050 computers by Monty Nov 4 2022120 REM130 REM link to Marcus BASIC program: http://www.naalaa.com/140 REM  community/showthread.php?tid=1053&pid=2984#pid2984 Oct 30 2022150 INIT 160 DIM T(200)170 REM Set 1 second delay time for 4051 or 4052/4054 based on RND(0)180 W=RND(0)190 IF W<0.2 THEN 220200 W=1805210 GO TO 230220 W=217230 J=RND(-1)240 J=1250 M=15260 FOR I=0 TO 99270 T(I+1)=10280 T(100+I+1)=0290 NEXT I300 GOSUB 1800310 PRINT "Dig at"320 GOSUB 780330 REM Display map, input initial dig.340 GOSUB 1320350 REM Generate map with m mines, make pos x, y safe.360 S=0370 F=M380 REM Set game state s to 0 and unused flags f to number of mines.390 GOSUB 2060400 REM Dig at x, y.410 REM Game loop =====================================================420 GOSUB 1800430 REM Display map.440 PRINT "Flags left: ";F450 PRI "Action (d = dig, f = add/remove flag, q = quit, c = cheat): ";460 INPUT A$470 IF A$="d" OR A$="D" THEN 490480 GO TO 500490 GOSUB 860500 IF A$="f" OR A$="F" THEN 520510 GO TO 530520 GOSUB 980530 IF A$="c" OR A$="C" THEN 550540 GO TO 560550 GOSUB 1270560 IF A$="q" OR A$="Q" THEN 580570 GO TO 590580 S=-1590 IF S=0 THEN 410600 GOSUB 1650610 IF S<0 THEN 630620 GO TO 650630 PRINT "Bye bye!"640 GO TO 700650 IF S>2 THEN 700660 GO TO S OF 670,690670 PRINT "ALL MINES MARKED, YOU SUCCEEDED!"680 GO TO 700690 PRINT "BOOM, YOU FAILED!"700 PRINT 710 REM GO TO 2000 720 PRINT "DO YOU WISH TO PLAY AGAIN (Y OR N): ";730 INPUT A$740 IF A$="Y" OR A$="" THEN 150750 FIND @5:1760 OLD @5:770 END 780 REM SUB: Input valid coordinates to x, y =========================790 PRINT "  X (0-9): ";800 INPUT X810 IF X<0 OR X>9 THEN 790820 PRINT "  Y (0-9): ";830 INPUT Y840 IF Y<0 OR Y>9 THEN 820850 RETURN 860 REM SUB: Dig action ==============================================870 PRINT "Dig at "880 GOSUB 780890 GOSUB 2460900 IF T(100+P+1)=0 THEN 930910 PRINT "You can't dig there!"920 RETURN 930 IF T(P+1)<>11 THEN 960940 S=2950 RETURN 960 GOSUB 2060970 RETURN 980 REM SUB: Add remove flag action ==================================990 PRINT "Add or remove flag at:"1000 GOSUB 7801010 GOSUB 24601020 IF T(100+P+1)=3 THEN 10401030 GO TO 10701040 T(100+P+1)=01050 F=F+11060 RETURN 1070 IF F=0 THEN 10901080 GO TO 11101090 PRINT "You're out of flags!"1100 RETURN 1110 IF T(100+P+1)>0 THEN 11301120 GO TO 11501130 PRINT "You can't place a flag there!"1140 RETURN 1150 F=F-11160 T(100+P+1)=31170 REM Change game to completed but restore if any mine is not flagged1180 S=11190 FOR Y=0 TO 91200 FOR X=0 TO 91210 IF T(Y*10+X+1)=11 AND T(100+Y*10+X+1)<>3 THEN 12301220 GO TO 12401230 S=01240 NEXT X1250 NEXT Y1260 RETURN 1270 REM SUB: Cheat action =============================================1280 GOSUB 16501290 FOR I=1 TO W*51300 NEXT I1310 RETURN 1320 REM SUB: Init map with m mines, make position x, y "a zero" =======1330 PRINT "Creating mine field .";1340 A=X1350 B=Y1360 C=01370 FOR Y=0 TO 91380 FOR X=0 TO 91390 IF X<A-1 OR X>A+1 OR Y<B-1 OR Y>B+1 THEN 14101400 GO TO 14301410 T(100+C+1)=Y*10+X1420 C=C+11430 NEXT X1440 PRINT ".";1450 NEXT Y1460 FOR I=1 TO M1470 PRINT ".";1480 J=INT(C*RND(1))1490 P=T(100+J+1)1500 GOSUB 25301510 T(Y*10+X+1)=111520 C=C-11530 PRINT ".";1540 FOR K=J TO C-11550 PRINT ".";1560 T(100+K+1)=T(100+K+2)1570 NEXT K1580 NEXT I1590 FOR I=100 TO 1991600 T(I+1)=01610 NEXT I1620 X=A1630 Y=B1640 RETURN 1650 REM SUB: Display actual map ======================================1660 PRINT "MINESWEEPER  X 0 1 2 3 4 5 6 7 8 9"1670 PRINT " Y+--------------------"1680 FOR Y=0 TO 91690 PRINT Y;"|";1700 FOR X=0 TO 91710 IF T(Y*10+X+1)<>11 THEN 17401720 PRINT " *";1730 GO TO 17501740 PRINT "  ";1750 NEXT X1760 PRINT 1770 NEXT Y1780 PRINT 1790 RETURN 1800 REM SUB: Display user view ======================================1810 PRINT "MINESWEEPER  X 0 1 2 3 4 5 6 7 8 9"1820 PRINT " Y+--------------------"1830 FOR Y=0 TO 91840 PRINT Y;"|";1850 FOR X=0 TO 91860 P=Y*10+X1870 GOSUB 19301880 NEXT X1890 PRINT 1900 NEXT Y1910 PRINT 1920 RETURN 1930 REM SUB: Print map character for position p =====================1940 IF T(100+P+1)<>3 THEN 19701950 PRINT " F";1960 RETURN 1970 IF T(P+1)>9 THEN 19901980 GO TO 20101990 PRINT " ?";2000 RETURN 2010 IF T(P+1)<>0 THEN 20402020 PRINT "  ";2030 RETURN 2040 PRINT T(P+1);2050 RETURN 2060 REM SUB: Update visibility at x, y =============================2070 GOSUB 24602080 IF P<0 THEN 21002090 GO TO 21102100 RETURN 2110 IF T(100+P+1)>0 THEN 21302120 GO TO 21402130 RETURN 2140 T(100+P+1)=12150 D=12160 FOR I=0 TO 992170 IF T(100+I+1)=1 THEN 21902180 GO TO 22202190 D=02200 P=I2210 GOSUB 22502220 NEXT I2230 IF D=0 THEN 21502240 RETURN 2250 REM SUB: Reveal p and possibly mark more to be checked ========2260 T(100+P+1)=22270 Z=P2280 GOSUB 25702290 T(Z+1)=R2300 IF R>0 THEN 24502310 P=Z2320 GOSUB 25302330 G=X2340 H=Y2350 FOR V=H-1 TO H+12360 FOR U=G-1 TO G+12370 X=U2380 Y=V2390 GOSUB 24602400 IF P=>0 AND T(100+P+1)=0 THEN 24202410 GO TO 24302420 T(100+P+1)=12430 NEXT U2440 NEXT V2450 RETURN 2460 REM SUB: Convert coordinates x, y to position p, -1 if invalid =2470 IF X<0 OR X>9 OR Y<0 OR Y>9 THEN 24902480 GO TO 25102490 P=-12500 RETURN 2510 P=Y*10+X2520 RETURN 2530 REM SUB: Convert position p to coordinates x, y, no checking ===2540 X=P-10*INT(P/10)2550 Y=INT(P/10)2560 RETURN 2570 REM SUB: Calculate number of mines nearby p ====================2580 R=02590 Q=P2600 GOSUB 25302610 G=X2620 H=Y2630 FOR V=H-1 TO H+12640 FOR U=G-1 TO G+12650 X=U2660 Y=V2670 GOSUB 24602680 IF P=>0 THEN 27002690 GO TO 27102700 R=R+(T(P+1)=11)2710 NEXT U2720 NEXT V2730 RETURN 2740 REM Debug print after QUIT2750 PRINT 2760 PRINT "  X 0  1  2  3  4  5  6  7  8  9";2770 PRINT "        X 0 1 2 3 4 5 6 7 8 9"2780 PRINT " Y+-----------------------------";2790 PRINT "       Y+--------------------"2800 FOR Y=0 TO 92810 PRINT Y;"|";2820 FOR X=0 TO 92830 E=Y*10+X+12840 PRINT T(E);2850 IF T(E)<10 THEN 28702860 GO TO 28802870 PRINT " ";2880 NEXT X2890 PRINT "     ";2900 PRINT Y;"|";2910 FOR X=0 TO 92920 PRINT T(100+Y*10+X+1);2930 NEXT X2940 PRINT 2950 NEXT Y2960 PRINT 2970 END 