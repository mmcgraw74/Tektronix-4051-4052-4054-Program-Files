1 REM Minesweeper for Tiny Basic, by Marcus2 REM Modified for Tektronix 4050 computers by Monty Nov 4 20223 GO TO 8483 REM link to Marcus BASIC program: http://www.naalaa.com/84 REM  community/showthread.php?tid=1053&pid=2984#pid2984 Oct 30 202285 INIT 86 REM SET KEYS87 DIM T(200)88 W=RND(0)89 IF W<.2 then 9190 W=191 J=RND(-1)92 J=193 M=1594 FOR I=0 TO 9995 T(I+1)=1096 T(100+I+1)=097 NEXT I98 GOSUB 118099 PRINT "Dig at"100 GOSUB 360110 REM Display map, input initial dig.120 GOSUB 840130 REM Generate map with m mines, make pos x, y safe.140 S=0150 F=M160 REM Set game state s to 0 and unused flags f to number of mines.170 GOSUB 1400180 REM Dig at x, y.190 REM Game loop =====================================================200 GOSUB 1180210 REM Display map.220 PRINT "Flags left: ";F230 PRI "Action (d = dig, f = add/remove flag, q = quit, c = cheat): ";240 INPUT A$242 IF A$="d" OR A$="D" THEN 244243 GO TO 245244 GOSUB 440245 IF A$="f" OR A$="F" THEN 247246 GO TO 248247 GOSUB 560248 IF A$="c" OR A$="C" THEN 250249 GO TO 251250 GOSUB 810251 IF A$="q" OR A$="Q" THEN 253252 GO TO 254253 S=-1254 IF S=0 THEN 190260 GOSUB 1030270 IF S<0 THEN 280275 GO TO 295280 PRINT "Bye bye!"290 GO TO 340295 IF S>2 THEN 340300 GO TO S OF 310,330310 PRINT "ALL MINES MARKED, YOU SUCCEEDED!"320 GO TO 340330 PRINT "BOOM, YOU FAILED!"340 PRINT 350 GOTO 2000 360 REM SUB: Input valid coordinates to x, y =========================370 PRINT "  X (0-9): ";380 INPUT X390 IF X<0 OR X>9 THEN 370400 PRINT "  Y (0-9): ";410 INPUT Y420 IF Y<0 OR Y>9 THEN 400430 RETURN 440 REM SUB: Dig action ==============================================450 PRINT "Dig at "460 GOSUB 360470 GOSUB 1640480 IF T(100+P+1)=0 THEN 510490 PRINT "You can't dig there!"500 RETURN 510 IF T(P+1)<>11 THEN 540520 S=2530 RETURN 540 GOSUB 1400550 RETURN 560 REM SUB: Add remove flag action ==================================570 PRINT "Add or remove flag at:"580 GOSUB 360590 GOSUB 1640600 IF T(100+P+1)=3 THEN 610605 GO TO 640610 T(100+P+1)=0620 F=F+1630 RETURN 640 IF F=0 THEN 650645 GO TO 670650 PRINT "You're out of flags!"660 RETURN 670 IF T(100+P+1)>0 THEN 680675 go to 700680 PRINT "You can't place a flag there!"690 RETURN 700 F=F-1710 T(100+P+1)=3720 REM Change game to completed but restore if any mine is not flagged730 S=1740 FOR Y=0 TO 9750 FOR X=0 TO 9760 IF T(Y*10+X+1)=11 AND T(100+Y*10+X+1)<>3 THEN 780770 go to 785780 S=0785 NEXT X790 NEXT Y800 RETURN 810 REM SUB: Cheat action =============================================820 GOSUB 1030830 RETURN 840 REM SUB: Init map with m mines, make position x, y "a zero" =======850 A=X860 B=Y870 C=0880 FOR Y=0 TO 9890 FOR X=0 TO 9900 IF X<(A-1) OR X>(A+1) OR Y<(B-1) OR Y>(B+1) THEN 920910 GO TO 940920 T(100+C+1)=Y*10+X930 C=C+1940 NEXT X950 NEXT Y960 FOR I=1 TO M970 J=INT(C*RND(1))980 P=T(100+J)990 GOSUB 17101000 T(Y*10+X+1)=111010 C=C-11012 FOR K=J TO C-11014 T(100+K+1)=T(100+K+2)1016 NEXT K1018 NEXT I1020 FOR I=100 TO 1991022 T(I+1)=01024 NEXT I1026 X=A1028 Y=B1029 RETURN 1030 REM SUB: Display actual map ======================================1040 PRINT "MINESWEEPER  X 0 1 2 3 4 5 6 7 8 9"1050 PRINT " Y+--------------------"1060 FOR Y=0 TO 91070 PRINT Y;"|";1080 FOR X=0 TO 91090 IF T(Y*10+X+1)<>11 THEN 11201100 PRINT " *";1110 GO TO 11301120 PRINT "  ";1130 NEXT X1140 PRINT 1150 NEXT Y1160 PRINT 1170 RETURN 1180 REM SUB: Display user view ======================================1190 PRINT "MINESWEEPER  X 0 1 2 3 4 5 6 7 8 9"1200 PRINT " Y+--------------------"1210 FOR Y=0 TO 91220 PRINT Y;"|";1230 FOR X=0 TO 91240 P=Y*10+X1250 GOSUB 12701260 NEXT X1262 PRINT1264 NEXT Y1266 PRINT1268 RETURN1270 REM SUB: Print map character for position p =====================1280 IF T(100+P+1)<>3 THEN 13101290 PRINT " F";1300 RETURN 1310 IF T(P+1)>9 THEN 13301320 GO TO 13501330 PRINT " ?";1340 RETURN 1350 IF T(P+1)<>0 THEN 13801360 PRINT "  ";1370 RETURN 1380 PRINT T(P+1);1390 RETURN 1400 REM SUB: Update visibility at x, y =============================1410 GOSUB 16401420 IF P<0 THEN 14301425 go to 14401430 RETURN1440 IF T(100+P+1) > 0 THEN 14451442 go to 14501445 RETURN1450 T(100+P+1) = 11460 D=11470 FOR I=0 TO 991480 IF T(100+I+1) = 1 THEN 14901485 GO TO 15201490 D=01500 P=I1510 GOSUB 16001520 NEXT I1530 IF D=0 THEN 14601540 RETURN1600 REM SUB: Reveal p and possibly mark more to be checked ========1610 T(100+P+1)=21620 Z=P1621 GOSUB 17501622 T(Z+1)=R1623 IF R>0 THEN 16381624 P=Z1625 GOSUB 17101626 G=X1627 H=Y1628 FOR V=H-1 TO H+11629 FOR U=G-1 TO G+11630 X=U1631 Y=V1632 GOSUB 16401633 IF P=>0 AND T(100+P+1)=0 THEN 16351634 GO TO 16361635 T(100+P+1)=11636 NEXT U1637 NEXT V1638 RETURN1640 REM SUB: Convert coordinates x, y to position p, -1 if invalid =1650 IF X<0 OR X>9 OR Y<0 OR Y>9 THEN 16701660 GO TO 16901670 P=-11680 RETURN 1690 P=Y*10+X1700 RETURN 1710 REM SUB: Convert position p to coordinates x, y, no checking ===1720 X=P-10*INT(P/10)1730 Y=INT(P/10)1740 RETURN 1750 REM SUB: Calculate number of mines nearby p ====================1760 R=01770 Q=P1780 GOSUB 17101790 G=X1800 H=Y1810 FOR V=H-1 TO H+11820 FOR U=G-1 TO G+11830 X=U1840 Y=V1850 GOSUB 16401860 IF P=>0 THEN 18801870 GO TO 18901880 R=R+(T(P+1)=11)1890 NEXT U1900 NEXT V1910 RETURN 1999 REM Debug print after QUIT2000 print2005 print "  X 0  1  2  3  4  5  6  7  8  9";2110 print "        X 0 1 2 3 4 5 6 7 8 9"2120 print " Y+-----------------------------";2130 print "       Y+--------------------"2140 for y = 0 to 92150 print y; "|";2160 for x = 0 to 92170 e = y * 10 + x +12180 print T(e);2190 if T(e) < 10 then 21952192 GO TO 22002195 print " ";2200 next x2210 print "     ";2220 print y;"|";2230 for x = 0 to 92240 print T(100 + y * 10 + x + 1);2250 next x2260 print2270 next y2280 print2290 end