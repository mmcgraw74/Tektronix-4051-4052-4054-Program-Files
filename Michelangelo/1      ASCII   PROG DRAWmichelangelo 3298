100 REM Tek 4050 Michelangelo with filled polygons - mcm 7 DEC 2024101 REM based on Georgios Patsos data file & 19 NOV 2024 post102 REM on facebook group "BASIC Programming Language"103 REM and Tekniques V3N1 "Shading Routine for Complex Shapes"104 INIT105 PRINT "MichelangeloFilled=Y or Unfilled=N polygons: ";106 INPUT G$107 F=1108 IF G$="Y" OR G$="y" THEN 110109 F=0110 PRINT "View R12 file=V, Create R12 file=C or No R12-VERY SLOW=N: ";111 INPUT G$112 F0=0113 IF G$<>"V" AND G$<>"C" THEN 121114 F0=1115 DIM R(4),R$(6),T(8),T$(12),U(10),U$(15),F$(10000),H$(252)116 F$=""117 IF G$="V" THEN 5000118 FIND@6:4120 REM rotate Michelangelo left 90deg by swapping X and Y input DATA121 VIEWPORT 32.5,130-32.5,0,100122 WINDOW 0,200,0,320123 DIM P(2,4),W(2,5),X(2),P1(2)124 REM set hatch Angle=0, no Crosshatch, hatch Distance=0.25125 A=0126 C=0127 D=0.25128 PAGE129 FIND@5:2130 INPUT@5:A$140 INPUT@5:A$145 L=0150 INPUT@5:A$155 L=L+2160 B$=SEG(A$,1,1)170 IF B$="E" THEN 360180 INPUT@5: Y0,X0,Y1,X1190 P(1,1)=X0200 P(2,1)=Y0210 N=1212 IF F=1 THEN 270214 IF F0=1 THEN 230216 MOVE X0,Y0218 DRAW X1,Y1220 GO TO 150229 REM draw original polygons - no fill and save R12 to file230 MOVE X0,Y0235 CALL "AGIN",X8,Y8240 DRAW X1,Y1241 CALL "AGIN",X9,Y9243 R(1)=-X8244 R(2)=-Y8245 R(3)=X9246 R(4)=Y9247 CALL "CHANGE",R,R$248 F$=REP(R$,LEN(F$)+1,0)250 GO TO 150260 REM detect final polygon vertex270 IF X1=P(1,1) AND Y1=P(2,1) THEN 340280 INPUT@5:A$290 L=L+2300 N=N+1310 INPUT@5: P(2,N),P(1,N),Y1,X1320 GO TO 270330 REM calc CENTROID, DILATE & DRAW polygon with n points340 GOSUB 2000350 GO TO 150359 REM write F$ in 252 byte or less (up to 46 R12 blocks) plus "|EOG|"360 HOME365 IF F=1 AND F0=1 THEN 500370 IF F0=0 THEN 490380 REM write R12 unfilled vector F$ to file 3390 FIND@5:3400 L=LEN(F$)410 P0=0420 L0=252430 H$=SEG(F$,P0+1,(L-P0) MIN 252)440 WRITE@5:H$450 P0=P0+((L-P0) MIN 252)460 IF P0<>L THEN 430470 H$="|EOG|"480 WRITE@5:H$490 GO TO 520500 F$="|EOG|"510 WRITE@6:F$520 END2000 REM CALC CENTROID (X0=average of X, Y0=average of Y) 2010 X0=02020 Y0=02030 FOR I=1 TO N2040 X0=X0+P(1,I)2050 Y0=Y0+P(2,I)2060 NEXT I2070 X0=X0/N2080 Y0=Y0/N2090 REM DILATE POLYGON BY 75%2092 REM center polygon centroid at 0,0 then multiply by dilation%2094 REM then move polygon back to original centroid2100 FOR I=1 TO N2110 P(1,I)=(P(1,I)-X0)*0.75+X02120 P(2,I)=(P(2,I)-Y0)*0.75+Y02130 NEXT I2139 REM NOW DRAW DILATED POLYGON2140 IF F0=1 THEN 23002150 MOVE P(1,1),P(2,1)2160 FOR I=2 TO N2170 DRAW P(1,I),P(2,I)2180 NEXT I2190 DRAW P(1,1),P(2,1)2200 GO TO 30002298 REM NOW DRAW AND then WRITE R12 DILATED POLYGON TO FILE 42299 REM use R()&R$ for hatch,T()&T$ for triangle,U()&U$ for quad poly2300 IF N=4 THEN 25002310 MOVE P(1,1),P(2,1)2320 CALL "AGIN",X8,Y82330 T(1)=-X82340 T(2)=-Y82350 FOR I=2 TO N2360 DRAW P(1,I),P(2,I)2370 CALL "AGIN",X8,Y82380 T((I-1)*2+1)=X82390 T((I-1)*2+2)=Y82400 NEXT I2410 DRAW P(1,1),P(2,1)2420 CALL "AGIN",X8,Y82430 T(7)=X82440 T(8)=Y82450 CALL "CHANGE",T,T$2460 F$=REP(T$,LEN(F$)+1,0)2470 GO TO 30002500 MOVE P(1,1),P(2,1)2510 CALL "AGIN",X8,Y82520 U(1)=-X82530 U(2)=-Y82540 FOR I=2 TO N2550 DRAW P(1,I),P(2,I)2560 CALL "AGIN",X8,Y82570 U((I-1)*2+1)=X82580 U((I-1)*2+2)=Y82590 NEXT I2600 DRAW P(1,1),P(2,1)2610 CALL "AGIN",X8,Y82620 U(9)=X82630 U(10)=Y82640 CALL "CHANGE",T,T$2650 F$=REP(T$,LEN(F$)+1,0)3000 REM now add horizontal hatch lines to fill this polygon3010 S=1.0E+3073020 L0=-1.0E+3073030 S1=SIN(A)3040 C1=COS(A)3050 FOR I=1 TO N3060 W(1,I)=P(1,I)*C1+P(2,I)*S13070 W(2,I)=-P(1,I)*S1+P(2,I)*C13080 S=S MIN W(2,I)3090 L0=L0 MAX W(2,I)3100 NEXT I3110 W(1,N+1)=W(1,1)3120 W(2,N+1)=W(2,1)3130 Y2=S+0.5*D3140 IF Y2>L0 THEN 40003150 K=03160 FOR I=1 TO N3170 W1=W(2,I) MIN W(2,I+1)3180 IF Y2<W1 THEN 33003190 W2=W(2,I) MAX W(2,I+1)3200 IF Y2=>W2 THEN 33003210 X1=W(1,I)-(W(2,I)-Y2)*(W(1,I)-W(1,I+1))/(W(2,I)-W(2,I+1))3220 K=K+13230 J=K3240 IF J=1 THEN 32903250 IF X(J-1)=>X1 THEN 32903260 X(J)=X(J-1)3270 J=J-13280 GO TO 32403290 X(J)=X13300 NEXT I3310 FOR I=1 TO K3320 P1(1)=X(I)*C1-Y2*S13330 P1(2)=X(I)*S1+Y2*C13335 IF F0=1 THEN 35003340 IF 2*INT(0.5*I)-I>-0.1 THEN 33703350 MOVE P1(1),P1(2)3360 GO TO 33803370 DRAW P1(1),P1(2)3380 NEXT I3390 Y2=Y2+D3400 GO TO 31403500 IF 2*INT(0.5*I)-I>-0.1 THEN 35603510 MOVE P1(1),P1(2)3520 CALL "AGIN",X8,Y83530 R(1)=-X83540 R(2)=-Y83550 GO TO 36203560 DRAW P1(1),P1(2)3570 CALL "AGIN",X8,Y83580 R(3)=X83590 R(4)=Y83600 CALL "CHANGE",R,R$3610 F$=REP(R$,LEN(F$)+1,0)3620 NEXT I3630 Y2=Y2+D3640 GO TO 31404000 IF LEN(F$)=0 THEN 40204010 WRITE@6:F$4020 F$=""4030 RETURN5000 PAGE5010 IF F0=0 THEN 50705020 FIND@5:45030 GO TO 50505040 FIND@5:35050 READ@5:F$5060 IF F$="|EOG|" THEN 50905070 CALL "RDRAW",F$,1,0,05080 GO TO 50505090 HOME5100 END