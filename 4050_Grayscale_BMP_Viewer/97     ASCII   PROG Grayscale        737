100 REM Grayscale R12 Picture Creator - Dec 12, 2022 Monty McGraw102 REM read Motorola S19 record format BMP max 256x200 gray pixels104 REM use GIMP to convert PIC to Grayscale Mode, then Scale Linear106 REM use HxD to export BMP file to Motorola S19 format108 REM use Notepad++ to replace CRLF with "CR" to create ASCII Strings110 INIT112 REM set X5 and Y5 to absolute D/A X,Y for image lower left corner114 X5=0116 Y5=0118 PAGE120 WINDOW 0,1023,0,779122 REM initialize R12 grayscale 4x4 vectors124 GOSUB 1000126 REM initialize serial port for BMP string input160 REM test with BMP file on Flash Drive & Display"165 GO TO 220170 CALL "RATE",9600,5,0180 CALL "TSTRIN","","",""190 CALL "RSTRIN","","",""200 CALL "CMFLAG",3220 PRINT "Convert BMP ASCII from Comm to R12 BIN on FlashDrive"230 PRINT "Enter the Flash Drive BINARY R12 output file number: ";240 INPUT F245 GO TO 390250 FIND @5:F260 INPUT @5,19:A$270 B$=SEG(A$,8,1)280 L=LEN(A$)290 S$=SEG(A$,38,L-38+1)300 S=VAL(S$)310 IF B$="B" OR B$="N" THEN 340320 PRINT "Flash Drive file# ";F;" is not a BINARY DATA file"330 GO TO 230340 PRINT "NOTE: Tek screen will blank during this process and"360 PRINT "Progress messages will be sent to Tera Term until DONE."370 PRINT "Press RETURN key - then Start PC Tera Term file transfer";380 INPUT A390 PAGE400 REM to test display DELETE 410 and XXX410 FIND @5:F430 INPUT@5:A$440 REM discard first $, check 2nd for BM" then for Image Width & Length450 INPUT@5:A$460 B$=SEG(A$,9,4)470 IF B$="424D" THEN 500480 PRINT "Not BMP S19 file format.Stop Tera Term file transfer!"490 GO TO 340500 B$=SEG(A$,47,4)510 CALL "HEXDEC",B$,W0520 B$=SEG(A$,51,4)530 CALL "HEXDEC",B$,H0540 IF W0<257 AND H0<201 THEN 570550 PRINT "Image is too Wide or too High: W=";W0;" H=";H0560 GO TO 340570 REM skip 1078 byte header including palette to image start @ 0x0436580 INPUT@5:A$590 B$=SEG(A$,5,4)600 IF B$<>"0420" THEN 580601 REM center the image if smaller than 256x200602 X0=INT(256-W0)*2604 Y5=INT(200-H0)*2605 X5=X0608 C=51610 FOR Y=1 TO H0620 FOR X=1 TO W0630 C=C+2632 IF C<73 THEN 640634 C=9636 INPUT@5:A$640 B$=SEG(A$,C,2)650 CALL "HEXDEC",B$,E660 I=INT(E/16)664 IF I=0 THEN 675670 GOSUB 2000675 X5=X5+4680 NEXT X682 X5=X0684 Y5=Y5+4690 NEXT Y700 HOME710 END1000 REM R12 Grayscale INIT subroutine 1010 REM Data is for R12 RDRAW vectors, 1,1 org, 9,x x=# vectors1020 REM skip "0" for blank, every VECTOR in object will get a dot there1030 DATA 2,31040 DATA 2,2,3,31050 DATA 1,2,3,2,4,41060 DATA 1,1,1,4,3,3,4,11070 DATA 2,1,1,3,2,4,3,3,4,21080 DATA 1,1,2,2,1,4,3,4,4,3,4,11090 DATA 2,1,2,2,1,3,2,4,4,4,3,3,4,21100 DATA 1,1,2,2,1,3,2,4,4,4,3,3,4,2,3,11110 DATA 2,1,1,2,2,3,1,4,3,4,4,4,4,3,3,2,4,11120 DATA 1,1,2,2,1,3,1,4,2,4,4,4,3,3,4,2,3,1,4,11130 DATA 1,1,2,1,1,2,1,3,2,3,1,4,3,4,4,4,4,3,3,2,4,11140 DATA 1,1,2,1,1,2,2,3,1,4,2,4,3,4,4,4,4,3,3,2,4,2,4,11150 DATA 1,1,2,1,1,2,1,3,2,3,1,4,3,4,4,4,4,3,3,2,4,2,3,1,4,11160 DATA 1,1,2,1,2,2,1,2,1,3,1,4,2,4,3,4,4,4,3,3,4,3,4,2,3,1,4,11170 DATA 1,1,2,1,1,2,2,3,1,3,1,4,2,4,3,4,4,4,4,3,3,3,3,2,4,2,3,1,4,11180 DIM G(240),H(16),Z$(4095),Y$(15*3),A$(77)1190 READ G1200 REM subtract 1 to move XY Vectors to 0,0 org1210 G=G-11220 REM H(I) has the index for the first X in vector I. H(16) is end1230 K=01240 FOR J=1 TO 151250 K=K+11260 H(J)=K1270 K=K+J*2-11280 NEXT J1290 REM add 16th index for length calculation on 151300 H(16)=K+11310 REM PAGE 1320 RETURN2000 REM append grayscale 4x4 dots index I at X5,Y5 on R12 R$2010 REM assumes X5,Y5 is indexed at lower left corner of next 4x42030 DELETE D,Z$2040 DIM D(I*2),Z$(I*3)2050 K=12060 FOR J=H(I) TO H(I+1)-1 STEP 22070 D(K)=G(J)+X52080 D(K+1)=G(J+1)+Y52090 K=K+22100 NEXT J2105 D=D*0.1282110 CALL "CHANGE",D,Z$2120 REM if this works - change to write to R12 file2130 CALL "RDOTS",Z$,1,0,02140 RETURN 