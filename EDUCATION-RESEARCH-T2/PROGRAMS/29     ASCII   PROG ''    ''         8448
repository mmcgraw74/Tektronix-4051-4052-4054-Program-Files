160 REM Edit/Display Overlay  [FILE 3]  ver. 03/06/79 e17165 DELETE 1170 DIM U$(20)180 R=0185 S3=1190 T(2)=1200 T(3)=1210 T(4)=0220 T(5)=125230 T(6)=0240 T(7)=0250 T(8)=1260 T(9)=1270 T(14)=5280 T(15)=95290 T(18)=1300 T(19)=1900 PAGE 1000 REM.............................................1010 REM......Display Menu-GoTo appropriate Rtn......1020 REM.............................................1030 PRINT " 1..Fit Against Baseline"1040 PRINT " 2..Plot on Screen 3..Set Wavelength Range"1050 PRINT " 4..Set Absorbance Range 5..Save Data 6..Input New File "1060 PRINT " 7..Plot on Digital Plotter 8..Flatten"1070 PRINT " 9..Fast Plot10..Delete Data Section"1080 PRINT "		* Enter Menu Item or		M for New Menu: ";1090 GOSUB 15101100 U1=VAL(U$)1110 GO TO U1 OF 32,3070,2050,2030,6010,28,36,7010,3030,80101120 PRINT "...What?"1130 GO TO 10801500 REM......Input Subrtn.1510 INPUT U$1520 IF U$="M" THEN 10301530 U$=U$&",0"1540 RETURN 2000 REM..................................2010 REM......Set Display Data Range......2020 REM..................................2030 R=22040 R=R+82050 R=R+22060 R=R+42070 U$=CHR(88+(R>11))2080 PRINT "		* Enter ";U$;2090 U$="Screen"2100 IF R=4 OR R=14 THEN 21202110 U$="Data"2120 PRINT " ";U$2130 PRINT "		From (in A): ";2140 GOSUB 15102150 T(R)=VAL(U$) MAX W2 MIN W12160 PRINT "		To   (in A): ";2170 GOSUB 15102180 T(R+1)=VAL(U$) MIN W1 MAX W22190 I=T(R) MIN T(R+1)2200 J=T(R) MAX T(R+1)2210 IF I<2700 OR J>11500 THEN 21302220 T(R)=I2230 T(R+1)=J2240 T(R+1)=T(R+1)-T(R)2250 IF R=6 THEN 24102260 R=02270 GO TO 10802400 REM......Recompute Ymax & Ymin for this range2410 X=T(7)+T(6)2420 R=02430 I=02500 REM......compute J1: starting index2510 IF W1-I*W3<=X THEN 25402520 I=I+12530 GO TO 25102540 J1=I*(I<>0)+(I=0)2600 REM......compute J2: stopping index2610 IF W1-I*W3<=T(6) THEN 26402620 I=I+12630 GO TO 26102640 J2=I*(I<>T(1))+(I=T(1))*T(1)2650 T(16)=10^392660 T(17)=-T(16)2700 REM......find max & min2710 FOR I=J1 TO J22720 T(16)=T(16) MIN Y(I)2730 T(17)=T(17) MAX Y(I)2740 NEXT I2750 T9=T(17)-T(16)2760 T(17)=T9*(T9<>0)+(T9=0)2770 GO TO 10803000 REM...............................3010 REM......Plot Data on Screen......3020 REM...............................3030 REM......plot every 10th pt for fast plot3040 WINDOW 0,130,0,1003050 VIEWPORT 0,130,0,1003060 S3=103070 IF T(17)>0 THEN 30903080 GOSUB 40303090 U9=43100 IF T(7)>0 THEN 31203110 GOSUB 42303120 GOSUB 50303130 U9=143140 GOSUB 50303150 U8=43160 PRINT "		";I$3170 HOME 3180 VIEWPORT T(4),T(4)+T(5),T(14),T(14)+T(15)3190 WINDOW T(6),T(6)+T(7),T(16),T(16)+T(17)3200 AXIS T(8),T(18)3300 REM......Label Y-axis3310 U1=13320 R2=T(18)/(T(17)/T(15))3330 R3=T(14)3340 U$=STR(T(16)+(U1-1)*T(18))3350 PRINT @32,21:0 MAX T(4)-(LEN(U$)+1)*1.78,R3-0.893360 PRINT U$;3370 IF U1>T(19) THEN 34203380 R3=R3+R23390 U1=U1+13400 GO TO 33403410 REM......Label X-axis3420 R2=T(8)/(T(7)/T(5))3430 R3=T(4)3440 U1=13450 U$=STR(T(6)+(U1-1)*T(8))3460 PRINT @32,21:0 MAX R3-(LEN(U$)+1)*1.78*0.5,T(14)-43470 PRINT U$;3480 IF U1>T(9) THEN 36103490 R3=R3+R23500 U1=U1+13510 GO TO 34503600 REM......Find starting index3610 T(24)=T(6)+T(7)3620 W4=03630 FOR I=1 TO T(1)3640 X=W1+W43650 W4=W4-W33660 REM3670 IF X<=T(24) THEN 36903680 NEXT I3690 MOVE W1+W4,Y(I)3800 REM......Plot Data3810 FOR U1=I TO T(1) STEP S33820 X=W1+W43830 W4=W4-W3*S33840 IF X<T(6) THEN 38703850 DRAW X,Y(U1)3860 NEXT U13870 HOME 3880 S3=13890 GO TO 10904000 REM.............................4010 REM......SUB to find max Y......4020 REM.............................4030 T(16)=10^394040 T(17)=-T(16)4050 REM4060 W4=04070 FOR U1=1 TO T(1)4080 T(16)=T(16) MIN Y(U1)4090 T(17)=T(17) MAX Y(U1)4100 NEXT U14110 T9=T(17)-T(16)4120 T(17)=T9*(T9<>0)+(T9=0)4130 RETURN 4200 REM...............................................4210 REM......SUB to assign max & min X-axis vals......4220 REM...............................................4230 T(6)=W24240 T(7)=W14250 T9=T(7)-T(6)4260 T(7)=T9*(T9<>0)+(T9=0)4270 RETURN 5000 REM................................................5010 REM......SUB to compute max & min axis values......5020 REM................................................5030 DIM S0(5)5040 S0(3)=INT(T(U9+1)/15)5050 S0(3)=T(U9+3)/S0(3)5060 S0(4)=INT(ABS(LGT(S0(3))))*SGN(LGT(S0(3)))5070 S0(4)=INT(10^S0(4)+1.0E-4)5080 IF S0(4)>0 THEN 51205090 S0(3)=15100 S0(4)=15110 GO TO 52005120 S0(5)=S0(3)/S0(4)5130 S0(3)=S0(4)*105140 IF S0(5)=>10 THEN 51605150 S0(3)=S0(4)*55160 IF S0(5)=>5 THEN 51805170 S0(3)=S0(4)*25180 IF S0(5)=>2 THEN 52005190 S0(3)=S0(4)5200 S0(5)=T(U9+2)/S0(3)5210 IF S0(5)=>0 THEN 52305220 S0(5)=S0(5)-0.99995230 S0(1)=S0(3)*(INT(ABS(S0(5)))*SGN(S0(5)))5240 S0(5)=(T(U9+3)+T(U9+2))/S0(3)5250 IF S0(5)<0 THEN 52705260 S0(5)=S0(5)+0.99995270 S0(2)=S0(3)*(INT(ABS(S0(5)))*SGN(S0(5)))5280 S0(5)=S0(2)-S0(1)5290 S0(4)=INT(INT(ABS(S0(5)))*SGN(S0(5))/S0(3))5300 IF S0(5)=>1 THEN 53305310 S0(3)=S0(5)5320 S0(4)=15330 IF S0(3)=>1 THEN 53605340 S0(3)=S0(5)5350 S0(4)=15360 T(U9+2)=S0(1)5370 T(U9+3)=S0(2)-S0(1)5380 T(U9+4)=S0(3)5390 T(U9+5)=S0(4)5400 T(U9+6)=1.75*T(U9+3)/T(U9+1)5410 DELETE S05420 RETURN 6000 REM..............................6010 REM......Save This Data Set......6020 REM..............................6030 PRINT "CHANGE ID? ";6040 INPUT A$6050 IF A$<>"Y" THEN 60806060 PRINT "ENTER ID: ";6070 INPUT I$6080 GOSUB 40306090 T(17)=T(17)+T(16)6100 T(16)=06110 PRINT "		* Save in File #:";6200 INPUT F16210 FIND F16220 PRINT "...Data Transfer ";6230 WRITE @33:I$,W1,W2,T(1)6240 FOR I=1 TO T(1)6250 WRITE @33:Y(I)6260 NEXT I6270 WRITE @33:T(16),T(17)6280 WRITE @33:S16290 FOR I=1 TO S16300 WRITE @33:S(I)6310 NEXT I6320 CLOSE 6330 PRINT "Complete"6340 GO TO 10807000 REM............................7010 REM......Flatten Data Set......7020 REM............................7025 PRINT "		* Enter Plotter Abs. limit: ";7026 INPUT M97030 PRINT "		* Enter G(GIN from 4662)		or    E(to Enter pts.): ";7040 INPUT A$7050 IF A$="G" THEN 71007060 PRINT "		Enter 2 points form:		x1,y1,x2,y2 (Angs,Abs)		* ";7070 INPUT X1,Y1,X2,Y27080 GO TO 73807100 REM *** Get section to Flatten7120 PRINT "		* Move pen to point 1 - push return"7130 WINDOW 0,150,0,1007140 VIEWPORT 0,150,0,1007150 INPUT A$7160 GIN @1:X1,Y17170 PRINT "";7180 PRINT "		* Move pen to point 2 -push return"7190 INPUT A$7200 GIN @1:X2,Y27210 PRINT @1,26:07220 PRINT "";7300 REM......Convert plot Units to Abs Values7310 Y1=M9*(Y1-10)/807320 Y2=M9*(Y2-10)/807330 REM......Convert plot Units to Angstroms7340 X1=10^5/(38-0.2*X1)7350 X2=10^5/(38-0.2*X2)7360 MOVE @1:190-10^6/(2*(X2-W3*0.9)),10+80*Y2/M97370 REM......Compute slope of flat line (M)7380 M=(Y1-Y2)/(X1-X2)7390 REM......Compute intercept of flat line (B)7400 B=Y2+X2*(Y1-Y2)/(X2-X1)7500 REM......Compute Y indices of start & stop pts.7510 X1=INT((W1-X1)/W3+1) MAX 1 MIN T(1)7520 X2=INT((W1-X2)/W3+1) MAX 1 MIN T(1)7530 IF X2=>X1 THEN 76007540 I=X17550 X1=X27560 X2=I7600 REM......ADJUST7610 PRINT "		* Adjust: E(Entire spectra) or"7620 PRINT "		        S(this Section only):";7630 INPUT A$7640 IF A$="S" THEN 77007650 X1=17660 X2=T(1)7700 REM......Subtract Flat line val (mX+b) from Yi7710 FOR I=X1 TO X27720 X=W1-W3*(I-1)7730 Y(I)=Y(I)-M*X-B7740 NEXT I7750 PRINT "		* Flatten Another Section? ";7760 INPUT A$7770 IF A$="Y" THEN 70307800 REM......RECOMPUTE MAX7810 FOR I=1 TO T(1)7820 M9=M9 MAX Y(I)7830 NEXT I7840 T(17)=M97850 GO TO 10808000 REM..........................8010 REM......Delete Section......8020 REM..........................8030 PRINT "		* ENTER END POINTS		of Data Rangeto be deleted:"8040 PRINT "		(Move pointer using Keys 1-4"8050 PRINT "		then press Key 5 to enter)"8060 X0=-18070 PRINT @32,18:58080 GIN @32:X,Z8090 MOVE @32:X,Z8100 PRINT @32,24:"|"8110 GO TO 81009000 REM......Ret from UDKey 5 to 90009010 IF X0>0 THEN 90409020 X0=X9030 GO TO 80809040 PRINT @32,18:09050 X9=X MIN X09060 X0=X MAX X09070 X9=INT((W1-X9)/W3+0.5) MIN T(1)-1 MAX 29080 X0=INT((W1-X0)/W3+0.5) MIN T(1)-1 MAX 29090 X=(Y(X9+1)-Y(X0-1))/(X9-X0+2)9100 FOR I=X0 TO X99110 Y(I)=Y(X0-1)+X*(I-X0+1)9120 NEXT I9130 HOME 9140 GO TO 1090