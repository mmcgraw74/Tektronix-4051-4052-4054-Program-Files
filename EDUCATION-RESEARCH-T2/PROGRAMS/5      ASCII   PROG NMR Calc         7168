1 GO TO 1004 GO TO 23008 GO TO 106012 I0=4114 GO TO 1060100 REM *****************************************************110 REM **    NMR PROGRAM                                 ***120 REM **                                                ***130 REM ** WRITTEN BY TOM PRICE AND JACK REID             ***140 REM ** LORILLARD,A DIVISION OF LOEWS, INC.            ***150 REM ** GREENSBORO,NC 27420                            ***160 REM **                                                ***170 REM ** MARCH,1978                                     ***180 REM **                                                ***185 REM *** 51/00-5202/0 ***190 REM *****************************************************200 GOSUB 2620210 I0=32220 DIM H(3,3),U(3,3),M(3,3),P(3,3),D1(15),S2(15),F1(3,3),S5(15),X(3)230 DIM I1(3)240 READ F1,N,X2,N1250 DATA 1,1,0,1,0,1,0,1,1,3,0,0260 PRINT "ENTER CHEMICAL SHIFTS: (IN HZ):"270 PRINT " PROTON No. 1 :";280 INPUT W1290 PRINT " PROTON No. 2 :";300 INPUT W2310 PRINT " PROTON No. 3 :";320 INPUT W3330 PRINT " ENTER COUPLING CONSTANTS (IN HZ) :"340 PRINT " J(1,2)= ";350 INPUT A1360 PRINT " J(1,3)= ";370 INPUT A3380 PRINT " J(2,3)= ";390 INPUT A2400 REM ** CALCULATE HIGHEST ENERGY LEVEL410 E1=0.5*(W1+W2+W3)+0.25*(A1+A2+A3)420 REM ** CALCULATE LOWEST ENERGY LEVEL430 E8=-0.5*(W1+W2+W3)+0.25*(A1+A2+A3)440 REM ** CALCULATE INTERMEDIATE ENERGY MATRIX ELEMENTS450 H(1,1)=0.5*(W1+W2-W3)+0.25*(A1-A2-A3)460 H(2,2)=0.5*(W1-W2+W3)+0.25*(-A1-A2+A3)470 H(3,3)=0.5*(-W1+W2+W3)+0.25*(-A1+A2-A3)480 H(1,2)=0.5*A2490 H(2,1)=H(1,2)500 H(1,3)=0.5*A3510 H(3,1)=H(1,3)520 H(2,3)=0.5*A1530 H(3,2)=H(2,3)540 REM ** DIAGONALIZE MATRIX550 PRINT "CALCULATION IN PROGRESS -- MATRIX DIAGONALIZATION!"560 GOSUB 1160570 REM ** TRANSFER DIAGONALIZED ELEMENTS INTO M AND P ARRAYS **580 M=H590 P=U600 REM ** CALCULATE INTERMEDIATE ENERGY MATRIX ELEMENTS610 H(1,1)=0.5*(W1-W2-W3)+0.25*(-A1+A2-A3)620 H(2,2)=0.5*(-W1+W2-W3)+0.25*(-A1-A2+A3)630 H(3,3)=0.5*(-W1-W2+W3)+0.25*(A1-A2-A3)640 H(1,2)=0.5*A1650 H(2,1)=H(1,2)660 H(1,3)=0.5*A3670 H(3,1)=H(1,3)680 H(2,3)=0.5*A2690 H(3,2)=H(2,3)700 REM ** DIAGONALIZE MATRIX710 GOSUB 1160720 REM ** CALCULATE TRANSITIONS AND INTENSITIES730 PRINT "CALCULATION IN PROGRESS -- TRANSITIONS AND INTENSITIES!"740 FOR J=1 TO 3750 D1(J)=E1-M(J,J)760 S4=0770 FOR K=1 TO 3780 S4=S4+P(K,J)790 NEXT K800 S5(J)=S4^2810 NEXT J820 L=3830 FOR J=1 TO 3840 FOR K=1 TO 3850 L=L+1860 D1(L)=M(J,J)-H(K,K)870 S4=0880 FOR J8=1 TO 3890 FOR K8=1 TO 3900 S4=S4+P(J8,J)*U(K8,K)*F1(J8,K8)910 NEXT K8920 NEXT J8930 S5(L)=S4^2940 NEXT K950 NEXT J960 FOR J=1 TO 3970 L=J+12980 D1(L)=H(J,J)-E8990 S4=01000 FOR K=1 TO 31010 S4=S4+U(K,J)1020 NEXT K1030 S5(L)=S4^21040 NEXT J1050 REM ** PRINT OUT FREQUENCY AND INTENSITY LISTING **1060 PRINT @I0:"NMR PATTERN FOR THREE SPIN SYSTEM"1070 PRINT @I0:"CHEMICAL SHIFT FREQ:    ";W1;" HZ, ";W2;" HZ, ";W3;" HZ"1080 PRINT @I0:"COUPLING CONSTANTS: J1,2= ";A1;" J2,3= ";A2;" J1,3= ";A31090 PRINT ""1100 FOR J=1 TO 151110 PRINT @I0: USING 1120:"LINE(",J,")=",D1(J)," HZ","INT =",S5(J)*101120 IMAGE 7X5A2D4A6D.2D3A33T6AFD.2D1130 NEXT J1140 I0=321150 END 1160 REM ** SUBROUTINE FOR MATRIX DIAGONALIZATION **1170 REM ** GENERATE THE JACOBI MATRIX **1180 READ U1190 DATA 1,0,0,0,1,0,0,0,11200 RESTORE 11901210 REM ** FIND MAX OFF DIAGONAL ELEMENT **1220 N2=N-11230 FOR I=1 TO N21240 X(I)=01250 I2=I+11260 FOR J=I2 TO N1270 IF X(I)>ABS(H(I,J)) THEN 13001280 X(I)=ABS(H(I,J))1290 I1(I)=J1300 NEXT J1310 NEXT I1320 REM ** INDICATOR FOR HALT - R1=7.450580596E-9 **1330 R1=7.450580596E-91340 H1=1.0E+381350 REM ** FIND PIVOT ELEMENT **1360 FOR I=1 TO N21370 IF I<=1 THEN 13901380 IF X2=>X(I) THEN 14201390 X2=X(I)1400 I3=I1410 J3=I1(I)1420 NEXT I1430 IF X2<=0 THEN 21801440 IF H1<=0 THEN 14601450 IF X2>H1 THEN 15301460 H3=ABS(H(1,1))1470 FOR I=2 TO N1480 IF H3<=ABS(H(I,I)) THEN 15001490 H3=ABS(H(I,I))1500 NEXT I1510 H1=H3*R11520 IF H1=>X2 THEN 21801530 N1=N1+11540 GOSUB 21901550 IF H(I3,I3)=>H(J3,J3) THEN 16201560 H4=H(I3,I3)1570 H(I3,I3)=H(J3,J3)1580 H(J3,J3)=H41590 H4=SGN(-S1)*C11600 C1=ABS(S1)1610 S1=H41620 FOR I=1 TO N21630 GO TO SGN(I-I3)+2 OF 1650,1780,16401640 GO TO I=J3 OF 17801650 IF I1(I)=I3 THEN 16701660 IF I1(I)<>J3 THEN 17801670 K=I1(I)1680 H4=H(I,K)1690 H(I,K)=01700 I2=I+11710 X(I)=01720 FOR J=I2 TO N1730 IF X(I)>ABS(H(I,J)) THEN 17601740 X(I)=ABS(H(I,J))1750 I1(I)=J1760 NEXT J1770 H(I,K)=H41780 NEXT I1790 X(I3)=01800 X(J3)=01810 FOR I=1 TO N1820 GO TO SGN(I-I3)+2 OF 1830,2110,19301830 H4=H(I,I3)1840 H(I,I3)=C1*H4+S1*H(I,J3)1850 IF X(I)=>ABS(H(I,I3)) THEN 18801860 X(I)=ABS(H(I,I3))1870 I1(I)=I31880 H(I,J3)=-S1*H4+C1*H(I,J3)1890 IF X(I)=>ABS(H(I,J3)) THEN 21101900 X(I)=ABS(H(I,J3))1910 I1(I)=J31920 GO TO 21101930 GO TO SGN(I-J3)+2 OF 1940,2110,20201940 H4=H(I3,I)1950 H(I3,I)=C1*H4+S1*H(I,J3)1960 IF X(I3)=>ABS(H(I3,I)) THEN 19901970 X(I3)=ABS(H(I3,I))1980 I1(I3)=I1990 H(I,J3)=-S1*H4+C1*H(I,J3)2000 IF X(I)=>ABS(H(I,J3)) THEN 21102010 GO TO 19002020 H4=H(I3,I)2030 H(I3,I)=C1*H4+S1*H(J3,I)2040 IF X(I3)=>ABS(H(I3,I)) THEN 20702050 X(I3)=ABS(H(I3,I))2060 I1(I3)=I2070 H(J3,I)=-S1*H4+C1*H(J3,I)2080 IF X(J3)=>ABS(H(J3,I)) THEN 21102090 X(J3)=ABS(H(J3,I))2100 I1(J3)=I2110 NEXT I2120 FOR I=1 TO N2130 H4=U(I,I3)2140 U(I,I3)=C1*H4+S1*U(I,J3)2150 U(I,J3)=-S1*H4+C1*U(I,J3)2160 NEXT I2170 GO TO 13602180 RETURN 2190 REMARK*** SUBROUTINE FOR ROTATION FACTORS OF H(I,I) AND H(J,J) **2200 T1=SGN(H(I3,I3)-H(J3,J3))*22210 T2=SQR((H(I3,I3)-H(J3,J3))^2+4*H(I3,J3)^2)2220 T1=T1*H(I3,J3)/(ABS(H(I3,I3)-H(J3,J3))+T2)2230 C1=1/SQR(1+T1^2)2240 S1=T1*C12250 H3=H(I3,I3)2260 H(I3,I3)=C1^2*(H3+T1*(2*H(I3,J3)+T1*H(J3,J3)))2270 H(J3,J3)=C1^2*(H(J3,J3)-T1*(2*H(I3,J3)-T1*H3))2280 H(I3,J3)=02290 RETURN 2300 REM   GRAPHICS PLOT ROUTINE ***2310 PRINT "ENTER OFFSET ";2320 INPUT O52330 PRINT "ENTER SPECTRAL WIDTH ";2340 INPUT W52350 IF W5<=0 THEN 23302360 PAGE 2370 VIEWPORT 40,120,10,1002380 M8=1.0E-32390 PRINT "FREQUENCY   INTENSITY"2400 FOR I=1 TO 152410 IF D1(I)<O5 OR D1(I)>O5+W5 THEN 24402420 PRINT USING 2590:D1(I),S5(I)2430 M8=M8 MAX S5(I)2440 NEXT I2450 WINDOW -O5-W5,-O5,0,M8+M8*0.12460 PRINT USING 2600:"OFFSET: ",O52470 PRINT USING 2600:"WIDTH : ",W52480 MOVE -O5,02490 RDRAW -W5,02500 FOR J=1 TO 152510 MOVE -D1(J),02520 RDRAW 0,S5(J)2530 NEXT J2540 FOR I=-O5 TO -O5-W5 STEP -W5/52550 MOVE I,02560 PRINT USING "FAFD.D":"",-I2570 NEXT I2580 PRINT @32,21:0,352590 IMAGE FD.2D14TFD.3D2600 IMAGE FA2XFD.2D2610 END 2620 PRINT "NMR CALCULATION FOR A THREE SPIN SYSTEM"2630 PRINT "     I N S T R U C T I O N S"2640 PRINT "      UDK#1 - PLOT SPECTRUM"2650 PRINT "      UDK#2 - LIST FREQUENCIES AND INTENSITIES"2660 PRINT "      UDK#3 - LIST FREQ AND INT ON THE PRINTER"2670 PRINT "ENTER ALL CHEMICAL SHIFTS AND COUPLING CONSTANTS IN"2680 PRINT " HERTZ. THE CALCULATED FREQUENCIES WILL BE IN HZ AND THE"2690 PRINT " INTENSITIES ARE IN RELATIVE INTENSITY UNITS."2700 RETURN 