1 INIT 2 GO TO 298 F=19 RETURN 12 F=-113 RETURN 15 REM CALCULATE SAGITTAL DISTANCE16 PRINT "Enter radius of curvature and diameter of surface ";17 INPUT X5,X618 PRINT "Sagittal distance is ";X5-SQR(X5^2-X6^2/4)19 RETURN 20 REM CALCULATE RADII FOR BENT LENS21 PRINT "Enter index and focal length desired ";22 INPUT X7,X523 PRINT "Enter shape factor desired ";24 INPUT X625 PRINT "First radius is ";2*X5*(X7-1)/(X6+1)26 PRINT "Second radius is ";2*X5*(X7-1)/(X6-1)27 RETURN 29 PAGE 30 PRINT "  VASSAR COLLEGE OPTICAL RAY-TRACE PROGRAM"31 PRINT "  ====== ======= ======= ========= ======="32 PRINT "  This program calculates the actual paths of light rays"33 PRINT "through a user-specified system of spherical or planar"34 PRINT "surfaces, lenses or mirrors.  Light rays proceed from"35 PRINT "left to right along the z-axis and are plotted in plan"36 PRINT "and elevation until they intersect the chosen image"37 PRINT "surface or a stop, or until they fail to intercept a"38 PRINT "subsequent optical surface.  Distances are in user units."39 PRINT "Two surfaces must be specified for each lens; one surface"40 PRINT "suffices for mirrors, stops and other plane surfaces.  A"41 PRINT "plot of the intersection of the rays with the image"42 PRINT "surface (X-Y plane) is also given.  Two calculation modes"43 PRINT "are possible: MANUAL, in which the user enters the starting "44 PRINT "position and direction of each ray to be traced; and"45 PRINT "AUTOMATIC, in which the user specifies either a common"46 PRINT "direction-angle (parallel light) ir a common starting"47 PRINT "(object) point, thus causing the program to cycle through"48 PRINT "a standard set of 21 rays distributed over four zones"49 PRINT "(0.25D,0.50D,0.707D,0.95D;D=diameter of the first surface)."50 PRINT "  Enough data is saved after an automatic cycle to allow"51 PRINT "an investigation of the image structure at any point"52 PRINT "after the exit pupil (the image surface is the last surface)."53 PRINT "A complete summary of a traced ray can be written onto tape"54 PRINT "for later detailed analysis."55 GOSUB 433060 DIM D(10,12),I2(21,5),B$(1),C(21,2),R(21),S(21)61 N=165 READ W1,W2,W4,I1,I,J1,M66 DATA 0,11,4,0,2,1,268 REM --D IS LENS DATA DEFAULT MATRIX--69 READ D70 DATA 0,1,1,1,1,1,1,1,2000,1,0,171 DATA 1,1,1,1,1,1,1,1,1,1,1,172 DATA 1,1,1,1,1,1,1,1,1,1,1,173 DATA 1,1,1,1,1,1,1,1,1,1,1,174 DATA 1,1,1,1,1,1,1,1,1,1,1,175 DATA 1,1,1,1,1,1,1,1,1,1,1,176 DATA 1,1,1,1,1,1,1,1,1,1,1,177 DATA 1,1,1,1,1,1,1,1,1,1,1,178 DATA 1,1,1,1,1,1,1,1,1,1,1,179 DATA 1,1,1,1,1,1,1,1,1,1,1,180 REM -- C IS AUTOMATIC CYCLING DATA --81 READ C82 DATA 0,0,0.25,0,0,-0.25,-0.25,0,0,0.25,0.354,0.35483 DATA 0.354,-0.354,-0.354,-0.354,-0.354,0.35484 DATA 0,0.707,0.5,0.5,0.707,0,0.5,-0.5,0,-0.70785 DATA -0.5,-0.5,-0.707,0,-0.5,0.5,0.672,0.67286 DATA 0.672,-0.672,-0.672,-0.672,-0.672,0.67290 REM --FILL SAVED DATA MATRIX WITH BLANKS --91 FOR L=1 TO 2192 R(L)=200093 S(L)=200094 FOR K=1 TO 595 I2(L,K)=200096 NEXT K97 NEXT L98 REM*** 51/00-5404/0  OPTICAL RAY TRACE     ***99 REM*** JAMES L. HUTCHINSON, VASSAR COLLEGE ***100 I=2110 PAGE 120 SET KEY 130 PRINT "SURFACE 1 is object surface at z=0"140 GO TO 160150 PAGE 160 PRINT "ENTER DATA FOR SURFACE ";I;":"170 PRINT "Lens (L), Mirror (M), or plane Surface (S) ";180 INPUT A$190 D(I,1)=1200 IF A$="L" THEN 250210 D(I,1)=0220 D(I,9)=2000230 IF A$="S" THEN 270240 D(I,1)=-1250 PRINT "Enter radius of curvature (+= convex) ";260 INPUT D(I,9)270 D(I,2)=SGN(D(I,9))280 PRINT "Enter z position of vertex ";290 INPUT D(I,11)300 PRINT "Enter diameter of surface (X -> Y) ";310 INPUT D(I,12)320 PRINT "Enter index of medium to left of surface ";330 INPUT D(I,10)340 IF D(I,11)<W2 THEN 360350 W2=D(I,11)+1360 D(I,12)=D(I,12)/2370 IF D(I,12)<W4 THEN 390380 W4=D(I,12)390 IF J1>0 THEN 570400 K=I-1410 K=K-1420 IF D(K,11)<=D(I,11) THEN 570430 D(I+1,1)=D(I,1)440 D(I+1,2)=D(I,2)450 D(I+1,9)=D(I,9)460 D(I+1,10)=D(I,10)470 D(I+1,11)=D(I,11)480 D(I+1,12)=D(I,12)490 D(I,1)=D(K,1)500 D(I,2)=D(K,2)510 D(I,9)=D(K,9)520 D(I,10)=D(K+1,10)530 D(I,11)=D(K,11)540 D(I,12)=D(K,12)550 I=I+1560 GO TO 410570 PRINT "More surfaces ";580 INPUT A$590 B$=SEG(A$,1,1)600 IF B$="N" THEN 660610 IF D(I,1)>0 THEN 630620 J1=-1630 I=I+1640 GO TO 150650 REM SCALE LENSES WIDTH & LENGTH660 X1=(W2-W1)/70 MAX W4/15670 SET NOKEY 680 W2=X1*70690 W4=X1*15700 D(1,12)=W4710 GOSUB 4110720 F1=0730 F2=0740 PRINT "RAY-CYCLING MODE: manual (M), or automatic (A) ";750 INPUT A$760 IF A$="A" THEN 950770 REM ---manual ray-cycling section---780 F1=F1+1790 F2=1800 PRINT "Enter x,y,z position of entering ray ";810 INPUT D(1,6),D(1,7),D(1,8)820 PRINT "Ray dir-cosines (D), or aiming pt (A)";830 INPUT A$840 PRINT "Enter data:";850 INPUT D(1,3),D(1,4),D(1,5)860 IF A$="D" THEN 1980870 Y1=D(1,3)-D(1,6)880 Y2=D(1,4)-D(1,7)890 Y3=D(1,5)-D(1,8)900 X1=SQR(Y1^2+Y2^2+Y3^2)910 D(1,3)=Y1/X1920 D(1,4)=Y2/X1930 D(1,5)=Y3/X1940 GO TO 1240950 PRINT "Fixed angle (A), or fixed object point (P)";960 INPUT A$970 IF A$="A" THEN 1110980 F2=2990 PRINT "Enter (x,y) coords of fixed object point ";1000 INPUT D(1,6),D(1,7)1010 F1=F1+11020 IF F1>21 THEN 31601030 X1=C(F1,1)*D(2,12)-D(1,6)1040 X2=C(F1,2)*D(2,12)-D(1,7)1050 X3=D(2,11)1060 X4=SQR(X1^2+X2^2+X3^2)1070 D(1,3)=X1/X41080 D(1,4)=X2/X41090 D(1,5)=X3/X41100 GO TO 12401110 PRINT "Enter (x,y) coords of object point of chief ray ";1120 F2=31130 INPUT C1,C21140 X3=D(2,11)1150 X4=SQR(C1^2+C2^2+X3^2)1160 D(1,3)=-C1/X41170 D(1,4)=-C2/X41180 D(1,5)=X3/X41190 F1=F1+11200 IF F1>21 THEN 31601210 D(1,6)=C(F1,1)*D(2,12)+C11220 D(1,7)=C(F1,2)*D(2,12)+C21230 D(1,8)=01240 IF F1>1 THEN 19801250 PAGE 1260 VIEWPORT 0,130,0,1001270 WINDOW 0,130,0,1001280 MOVE @N:10,901290 PRINT @N: USING 4410:1300 MOVE @N:5,201310 FOR K=5 TO 75 STEP 21320 DRAW @N:K,351330 MOVE @N:K+1,351340 NEXT K1350 MOVE @N:75,351360 DRAW @N:75,501370 DRAW @N:5,501380 FOR K=5 TO 75 STEP 21390 DRAW @N:K,651400 MOVE @N:K+1,651410 NEXT K1420 MOVE @N:75,651430 DRAW @N:75,801440 DRAW @N:5,801450 DRAW @N:5,201460 DRAW @N:75,201470 DRAW @N:75,751480 DRAW @N:125,751490 DRAW @N:125,251500 DRAW @N:75,251510 VIEWPORT 5,75,20,501520 WINDOW W1,W2,-W4,W41530 F=01540 REM ***** plot side view of lenses *****1550 J=11560 Y2=D(J,9)1570 Y4=D(J,12)1580 IF Y2>1000 THEN 16601590 FOR X1=-Y4 TO Y4 STEP Y4/101600 Y3=D(J,11)+Y2*(1-SQR(1-(X1/Y2)^2))1610 IF X1>-Y4 THEN 16301620 MOVE @N:Y3,X11630 DRAW @N:Y3,X11640 NEXT X11650 GO TO 16801660 MOVE @N:D(J,11),-D(J,12)1670 DRAW @N:D(J,11),D(J,12)1680 REM--CLOSE LENS EDGES--1690 X1=Y41700 IF D(J,10)=1 THEN 17601710 IF D(J-1,12)<>D(J,12) THEN 17601720 X2=D(J-1,11)+D(J-1,9)*(1-SQR(1-(D(J,12)/D(J-1,9))^2))1730 DRAW @N:X2,X11740 MOVE @N:X2,-X11750 DRAW @N:Y3,-X11760 IF J=I THEN 17901770 J=J+11780 GO TO 15601790 REM ***** plot top view of lenses *****1800 MOVE @N:W2/2,-0.95*W41810 IF F>0 THEN 18601820 PRINT @N:"Y vs Z";1830 F=11840 VIEWPORT 5,75,50,801850 GO TO 15501860 REM ***** plot bullseye for image surface ****1870 PRINT @N:"X vs Z";1880 VIEWPORT 75,125,25,751890 X1=D(I,12)1900 WINDOW -X1,X1,-X1,X11910 AXIS @N:1,1,0,01920 WINDOW 75,125,25,751930 MOVE @N:100,251940 PRINT @N:"IMAGE SURFACE (X vs Y)"1950 IF N>1 THEN 19801960 PRINT "Change pen color if desired."1970 GOSUB 43301980 J=11990 J2=J+12000 IF D(J,1)<0 THEN 22502010 REM ***APPLY REFRACTION TRANSFORM***2020 Z1=D(J,9)2030 IF Z1<1000 THEN 20602040 IF J=I THEN 27502050 Z1=1.0E+1002060 Z2=D(J,10)2070 Z3=D(J2,10)2080 Z4=SGN(D(J,5))2090 X1=D(J,6)/ABS(Z1)2100 X2=D(J,7)/ABS(Z1)2110 Y4=SQR(1-X1^2-X2^2)2120 X3=(D(J,8)-D(J,11)-D(J,9))/D(J,9)2130 Y1=ABS(X3*D(J,5)-X1*D(J,3)-X2*D(J,4))2140 Y2=(Z2/Z3)^22150 Y2=1-Y2*(1-Y1^2)2160 IF Y2<0 THEN 26302170 Y2=SQR(Y2)2180 Y3=(Z3*Y2-Z2*Y1)/Z12190 Y3=Y3*Z42200 D(J2,3)=(Z2*D(J,3)-Y3*D(J,6))/Z32210 D(J2,4)=(Z2*D(J,4)-Y3*D(J,7))/Z32220 D(J2,5)=SQR(1-D(J2,4)^2-D(J2,3)^2)2230 D(J2,5)=Z4*D(J2,5)2240 GO TO 23302250 REM ***APPLY REFLECTION TRANSFORM***2260 X1=D(J,6)/D(J,9)2270 X2=D(J,7)/D(J,9)2280 Y1=SQR((1-X1^2-X2^2)*(1-D(J,3)^2-D(J,4)^2))2290 Y1=Y1-X1*D(J,3)-Y1*D(J,4)2300 D(J2,3)=D(J,3)+2*Y1*X12310 D(J2,4)=D(J,4)+2*Y1*X22320 D(J2,5)=D(J,5)-2*Y1*SQR(1-X1^2-X2^2)2330 REM ***APPLY TRANSLATION TRANSFORM***2340 FUZZ 5,1.0E-52350 X=D(J,6)2360 Y=D(J,7)2370 Z=D(J,8)2380 Z3=D(J2,9)2390 Z1=D(J2,11)+Z32400 IF D(J,5)=0 THEN 25902410 X1=D(J2,3)/D(J2,5)2420 X2=X1^22430 Y1=D(J2,4)/D(J2,5)2440 Y2=Y1^22450 X3=X*X1+Y*Y12460 Y3=Z*(X2+Y2)2470 A0=1+X2+Y22480 B0=2*(X3-Y3-Z1)2490 C0=X^2+Y^2-2*Z*X3+Y3*Z+Z1^2-Z3^22500 Z4=B0^2-4*A0*C02510 F3=12520 IF Z4<0 THEN 25902530 Z2=(-B0-D(J2,2)*SQR(Z4))/2/A02540 D(J2,6)=X+X1*(Z2-Z)2550 D(J2,7)=Y+Y1*(Z2-Z)2560 D(J2,8)=Z22570 Y3=SQR(D(J2,6)^2+D(J2,7)^2)2580 IF Y3<D(J2,12) THEN 26302590 F3=-12600 IF F2>1 THEN 30402610 PRINT "Ray does not intersect surface."2620 GO TO 28802630 REM PLOT NEXT RAY; TOP VIEW2640 VIEWPORT 5,75,50,802650 WINDOW W1,W2,-W4,W42660 MOVE @N:D(J,8),D(J,6)2670 DRAW @N:D(J2,8),D(J2,6)2680 REM PLOT RAY; SIDE VIEW2690 VIEWPORT 5,75,20,502700 WINDOW W1,W2,-W4,W42710 MOVE @N:D(J,8),D(J,7)2720 DRAW @N:D(J2,8),D(J2,7)2730 J=J22740 GO TO 19902750 REM PLOT IMAGE POINT2760 VIEWPORT 75,125,25,752770 X1=D(I,12)2780 WINDOW -X1,X1,-X1,X12790 MOVE @N:D(I,6),D(I,7)2800 SCALE 5,52810 RMOVE @N:1,02820 RDRAW @N:-2,02830 RMOVE @N:1,12840 RDRAW @N:0,-22850 GO TO F2 OF 2860,3050,30502860 HOME 2870 PRINT "Save data (S), or ";2880 PRINT "Calc another ray (C), or End calcs (E) ";2890 INPUT A$2900 IF A$="S" THEN 29302910 IF A$="E" THEN 31602920 GO TO 912930 PRINT "DATA SAVE: Press KEY 2 to save temporarily"2940 PRINT "    Press KEY 3 to also save on tape"2950 F=02960 SET KEY 2970 IF F>0 THEN 30302980 IF F<0 THEN 30002990 GO TO 29703000 PRINT "Which tape unit ";3010 INPUT M3020 WRITE @M:D3030 SET NOKEY 3040 REM ****DATA SAVING SECTION****3050 I1=I1+13060 IF F3=1 THEN 30803070 GO TO F2 OF 2880,1010,11903080 I2(I1,1)=D(I,6)3090 I2(I1,2)=D(I,7)3100 R(I1)=D(I,6)3110 S(I1)=D(I,7)3120 I2(I1,3)=D(I,3)3130 I2(I1,4)=D(I,4)3140 I2(I1,5)=D(I,5)3150 GO TO F2 OF 2880,1010,11903160 REM ***END CALCULATION SECTION***3170 PRINT "Change some parameters (C), or Begin anew (B), or ";3180 PRINT "Investigate image   structure (S), or ";3190 PRINT "End program (E) ";3200 INPUT A$3210 IF A$="S" THEN 33203220 IF A$="E" THEN 41003230 IF A$="B" THEN 32803240 IF A$<>"C" THEN 31703250 I1=03260 GOSUB 41103270 GO TO 7203280 W2=113290 W4=13300 I1=03310 GO TO 913320 REM *** image structure section ***3330 PAGE 3340 PRINT "Change paper on plotter."3350 GOSUB 43303360 VIEWPORT 10,90,10,903370 WINDOW 10,90,10,903380 MOVE @N:20,203390 DRAW @N:20,803400 DRAW @N:80,803410 DRAW @N:80,203420 DRAW @N:20,203430 MOVE @N:10,903440 PRINT @N: USING 4410:3450 PRINT "Enter maximum diameter of image surface to be plotted ";3460 INPUT D13470 MOVE @N:20,173480 RDRAW @N:2,13490 RMOVE @N:0,-23500 RDRAW @N:-2,13510 DRAW @N:43,173520 MOVE @N:48,163530 PRINT @N: USING 3540:D13540 IMAGE "",6d.4d3550 MOVE @N:57,173560 DRAW @N:80,173570 RDRAW @N:-2,13580 RMOVE @N:0,-23590 RDRAW @N:2,13600 MOVE @N:50,203610 RDRAW @N:0,23620 PRINT @N: USING 3540:I2(1,1)3630 MOVE @N:50,103640 PRINT @N:"MAP OF IMAGE SURFACE"3650 MOVE @N:80,503660 RDRAW @N:-2,03670 SET DEGREES 3680 PRINT @1,25:903690 PRINT @N: USING 3540:I2(1,2)3700 PRINT @1,25:03710 GOSUB 44203720 Z1=D(I,11)3730 X4=I2(1,2)+D1/23740 X3=X4-D13750 X2=I2(1,1)+D1/23760 X1=X2-D13770 Z=Z13780 L=13790 VIEWPORT 10,90,10,903800 PRINT @1,17:1,13810 FOR K=1 TO I13820 WINDOW X1,X2,X3,X43830 MOVE @N:R(K),S(K)3840 SCALE 1,13850 RMOVE @N:-0.333,-0.3063860 A$=CHR(K+64)3870 PRINT @N:A$3880 NEXT K3890 PRINT @1,17:1.792,2.8163900 WINDOW 20,80,20,803910 MOVE @N:100,803920 FOR K=1 TO L3930 PRINT @N:"";3940 NEXT K3950 PRINT @N:"SURFACE AT ";Z23960 PRINT "Done (D), or move surface (M), or Replot (R) ";3970 INPUT A$3980 IF A$="D" THEN 31903990 IF A$="R" THEN 33304000 PRINT "Move image surface to ";4010 INPUT Z24020 L=L+14030 Z=Z2-Z14040 FOR K=1 TO I14050 X=Z/I2(K,5)4060 R(K)=I2(K,1)+X*I2(K,3)4070 S(K)=I2(K,2)+X*I2(K,4)4080 NEXT K4090 GO TO 38004100 END 4110 REM === MENU-TYPE INPUT SECTION ===4120 PAGE 4130 PRINT "You can change any of the following data:"4140 PRINT "Item#1- Radius of curvature of surface"4150 PRINT "Item#2- Index to left of surface"4160 PRINT "Item#3- Z-position of surface"4170 PRINT "Item#4- Diameter of surface"4180 PRINT "Present values are:"4190 PRINT "Surface#  Radius  Index  Position  Diameter"4200 PRINT "========  ======  =====  ========  ========"4210 FOR K=1 TO I4220 PRINT USING 4240:K,D(K,9),D(K,10),D(K,11),D(K,12)4230 NEXT K4240 IMAGE 4d,9d.2d,3d.3d,6d.2d,6d.2d4250 PRINT "Any changes ";4260 INPUT A$4270 IF A$="N" THEN 43204280 PRINT "Input surface number, item number and new value: ";4290 INPUT K,J,X14300 D(K,J+8)=X14310 GO TO 41204320 RETURN 4330 REM PROGRAMMED WAIT---4340 SET KEY 4350 PRINT "Press USER KEY 2 to resume program."4360 F=-14370 IF F>0 THEN 43904380 GO TO 43704390 SET NOKEY 4400 RETURN 4410 IMAGE "VASSAR COLLEGE OPTICAL RAY-TRACE PROGRAM"4420 N=14430 SET DEGREES 4440 VIEWPORT 90,129,20,654450 WINDOW -39,39,-50,504460 MOVE @N:0,04470 DRAW @N:0,04480 MOVE @N:25,04490 A9=SIN(3)4500 B9=COS(3)4510 X=254520 Y=04530 FOR J=1 TO 1204540 Y1=Y*B9-X*A94550 X1=X*B9+Y*A94560 X=X14570 Y=Y14580 DRAW @N:X,Y4590 NEXT J4600 PRINT @1,17:1.5,1.54610 FOR J=1 TO 214620 WINDOW -39,39,-50,504630 MOVE @N:25*C(J,1),25*C(J,2)4640 SCALE 1,14650 RMOVE @N:-0.597,-0.864660 A$=CHR(J+64)4670 PRINT @N:A$;4680 NEXT J4690 WINDOW -39,39,-50,504700 MOVE @N:-25,-304710 RDRAW @N:4,24720 RMOVE @N:0,-44730 RDRAW @N:-4,24740 DRAW @N:-15,-304750 MOVE @N:15,-304760 DRAW @N:25,-304770 RDRAW @N:-4,24780 RMOVE @N:0,-44790 RDRAW @N:4,24800 MOVE @N:0,-30.864810 PRINT @N:"diameterof first surface";4820 MOVE @N:0,-404830 PRINT @N:"LOCATION OF RAYS";4840 PRINT @1,17:1.792,2.8014850 RETURN 